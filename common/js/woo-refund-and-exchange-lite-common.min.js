jQuery((function(r){r(".wps_rma_return_notification").hide(),r("#wps_rma_return_request_form").on("submit",(function(e){e.preventDefault();var _=r(this).data("orderid"),a="",t=new Array,o="",s=wrael_common_param.check_pro_active,n=r("#wps_rma_return_request_subject").val();""!=n&&null!=n||""!=(n=r("#wps_rma_return_request_subject_text").val())&&null!=n||(a+="<li>"+wrael_common_param.return_subject_msg+"</li>");var c=r(".wps_rma_return_request_reason").val();void 0===c||""!=c&&null!=c||(a+="<li>"+wrael_common_param.return_reason_msg+"</li>"),s&&"function"==typeof wps_rma_return_alert_condition_addon&&(a+=wps_rma_return_alert_condition_addon());var m=wrael_common_param.refund_form_attachment;m&&"on"==m&&r(".wps_rma_return_request_files").each((function(){var e=r(this);if(e[0].files.length){var _=e[0].files[0].type;"image/png"==_||"image/jpeg"==_||"image/jpg"==_||(a+="<li>"+wrael_common_param.file_not_supported+"</li>")}}));var p=null,i=!1;s?(r(".wps_rma_return_column").each((function(){if(r(this).find(".wps_wrma_return_product").is(":checked")){const _=r(this).data("item_id"),a=r(this).find(".wps_rma_return_product_qty").val();var e={};e.item_id=_,e.qty=a,t.push(e);const o=r(this).find(".wps_rma_return_product_qty").attr("max");parseInt(a)>parseInt(o)&&(i=!0)}})),p=r("#wps_rma_customer_contact_refund").val(),o=wps_rma_refund_method()):r(".wps_rma_return_column").each((function(){const e=r(this).data("item_id"),_=r(this).find(".wps_rma_return_product_qty").val();var a={};a.item_id=e,a.qty=_,t.push(a);const o=r(this).find(".wps_rma_return_product_qty").attr("max");parseInt(_)>parseInt(o)&&(i=!0)})),i&&(a+="<li>"+wrael_common_param.correct_quantity+"</li>");var l=!1;if(r.each(t,(function(r,e){parseInt(e.qty)||(l=!0)})),l&&(a+="<li>"+wrael_common_param.qty_error+"</li>"),""!=a)return r("#wps_rma_return_alert").show(),r("#wps_rma_return_alert").html(a),r("#wps_rma_return_alert").addClass("woocommerce-error"),r("#wps_rma_return_alert").removeClass("woocommerce-message"),r("#wps_rma_return_alert").css("background-color","red"),r("html, body").animate({scrollTop:r("#wps_rma_return_request_container").offset().top},800),!1;r("#wps_rma_return_alert").hide(),r("#wps_rma_return_alert").html(a);var u={action:"wps_rma_save_return_request",products:t,subject:n,reason:c,orderid:_,bankdetails:r("#wps_rma_bank_details").val(),refund_method:o,security_check:wrael_common_param.wps_rma_nonce,all_product_checked:r(".wps_wrma_return_product_all").is(":checked"),wps_rma_customer_contact_refund:p},d=new FormData(this);d.append("action","wps_rma_return_upload_files"),d.append("security_check",wrael_common_param.wps_rma_nonce),r(".wps_rma_return_notification").show(),r.ajax({url:wrael_common_param.ajaxurl,type:"POST",data:d,contentType:!1,cache:!1,processData:!1,success:function(e){r.ajax({url:wrael_common_param.ajaxurl,type:"POST",data:u,dataType:"json",success:function(e){var a=10;setInterval((function(){a>=0&&r("#countdownTimer").html(a),a-=1}),1e3);r("#wps_rma_return_alert").removeClass("woocommerce-error"),r("#wps_rma_return_alert").addClass("woocommerce-message"),r("#wps_rma_return_alert").css("background-color","#8FAE1B"),r("#wps_rma_return_alert").show(),r("#wps_rma_return_alert").html(e.msg+' in <b><span id="countdownTimer"></span> seconds</b>'),r(".wps_rma_return_notification").hide(),r("html, body").animate({scrollTop:r("#wps_rma_return_request_container").offset().top},800),void 0!==e.auto_accept&&1==e.auto_accept?"function"==typeof wps_rma_refund_auto_accept&&wps_rma_refund_auto_accept(_):window.setTimeout((function(){window.location.href=wrael_common_param.myaccount_url}),11e3)}})}})})),r(document).on("click",".wps_remove_notice_msg",(function(e){e.preventDefault(),r(".wps_order_msg_notice_wrapper").hide()})),r(document).on("click","#wps_order_msg_submit",(function(e){e.preventDefault();var _=r("#wps_order_msg_attachment"),a=r("#wps_order_new_msg").val(),t=r("#order_msg_type").val(),o="",s=r(this).data("id"),n=null;wrael_common_param.check_pro_active&&(n=r("#wps_rma_customer_contact_order_message").val());var c=new FormData,m=wrael_common_param.order_msg_attachment;if(m&&"on"==m&&_[0]){var p=_[0].files.length;if(p)for(var i=0;i<p;i++){var l=_[0].files[i].type;"image/png"==l||"image/jpeg"==l||"image/jpg"==l?c.append("wps_order_msg_attachment[]",_[0].files[i]):o='<p class="wps_order_msg_sent_notice">'+wrael_common_param.file_not_supported+'</p><a href="" class="wps_remove_notice_msg">X</a>'}}if(""==a&&(o='<p class="wps_order_msg_sent_notice">'+wrael_common_param.message_empty+'</p><a href="" class="wps_remove_notice_msg">X</a>'),o)return r(".wps_order_msg_notice_wrapper").css("display","flex"),r(".wps_order_msg_notice_wrapper").css("background-color","red"),r(".wps_order_msg_notice_wrapper").html(o),r("#wps_order_msg_submit").css({"outline-color":"white","border-color":"white"}),!1;c.append("action","wps_rma_order_messages_save"),c.append("msg",a),c.append("order_msg_type",t),c.append("wps_rma_customer_contact_order_message",n),c.append("order_id",s),c.append("security_check",wrael_common_param.wps_rma_nonce),r.ajax({url:wrael_common_param.ajaxurl,type:"post",data:c,dataType:"json",contentType:!1,processData:!1,success:function(e){if(e){var _='<p class="wps_order_msg_sent_notice">'+wrael_common_param.message_sent+'</p><a href="" class="wps_remove_notice_msg">X</a>';r(".wps_order_msg_notice_wrapper").css("background-color","#64CD83"),r(".wps_order_msg_notice_wrapper").css("display","flex"),r("#wps_order_msg_submit").css({"outline-color":"none","border-color":"none"}),r(".wps_order_msg_sub_container").load(document.URL+" .wps-order-msg__row"),r("#wps_order_new_msg").val(""),r("#wps_order_msg_attachment").val(""),r(".wps_order_msg_notice_wrapper").html(_)}}})})),r(".wps_order_msg_reload_notice_wrapper").hide(),r(document).on("click",".wps_reload_messages",(function(e){e.preventDefault(),r(this).addClass("wps-loader-icon"),r(".wps_order_msg_sub_container").load(document.URL+" .wps-order-msg__row"),setTimeout((function(){r(".wps_reload_messages").removeClass("wps-loader-icon"),r(".wps_order_msg_reload_notice_wrapper").show(),r(".wps_order_msg_reload_notice_wrapper").css({"background-color":"rgb(100, 205, 131)","border-radius":"5px",color:"white","padding-left":"10px"})}),2e3),setTimeout((function(){r(".wps_order_msg_reload_notice_wrapper").hide()}),3e3)})),r(document).on("click",".wps_order_send_msg_dismiss",(function(e){e.preventDefault(),r(".wps_order_msg_notice_wrapper").hide()})),r(document).on("submit","#wps_rma_cancel_return_request",(function(e){if(e.preventDefault(),!confirm(wrael_common_param.return_cancellation_alert))return;var _={action:"wps_rma_cancel_return_request",order_id:r(".wps_rma_cancel_return_request").val(),security_check:wrael_common_param.wps_rma_nonce};r.ajax({url:wrael_common_param.ajaxurl,type:"POST",data:_,dataType:"json",success:function(r){window.location.href=window.location.href}})}))}));